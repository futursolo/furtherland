##
##   Copyright 2015 Futur Solo
##
##   Licensed under the Apache License, Version 2.0 (the "License");
##   you may not use this file except in compliance with the License.
##   You may obtain a copy of the License at
##
##       http://www.apache.org/licenses/LICENSE-2.0
##
##   Unless required by applicable law or agreed to in writing, software
##   distributed under the License is distributed on an "AS IS" BASIS,
##   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
##   See the License for the specific language governing permissions and
##   limitations under the License.
<%inherit file="framework.htm"/>
<%block name="css">
<link href="${management_url("working.css")}" rel="stylesheet" type="text/css">
</%block>
${parent.header()}
    <div class="main management">
        <div class="working">
            <div class="page-title">${page_title}</div>
            <div class="left">
                <div class="editor">
                    <div>
                        <input id="working-title" type="text" class="input" placeholder="请在此输入题目" value="${get_pre_content("title", pre_working)}">
                    </div>
                    <div>
                        <div id="working-content-wrapper" class="textarea">
                            <div></div>
                            <textarea id="working-content">${get_pre_content("content", pre_working)}</textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="float-block">
                    <div class="title">写作提示</div>
                    <div class="content">
                        <div>FurtherLand支持GitHub Flavored Markdown以及绝大部分HTML5代码，请尽情使用。</div>
                    </div>
                </div>
                <div class="float-block drag-upload-area">
                    <div class="title">文件</div>
                    <div class="content">
                        <div>拖放文件到这里来上传 或<br><span id="upload-button" class="button">从「公共区域」选择文件</span></div>
                    </div>
                </div>
                <div class="float-block">
                    <div class="title">设置短链接</div>
                    <div class="content">
                        <div>必须匹配 ^([\-a-zA-Z0-9]+)$ ！</div>
                        <div><input id="slug" type="text" class="input" value="${get_pre_content("slug", pre_working)}" placeholder="(Required)"></div>
                    </div>
                </div>
                <div class="float-block">
                    <div class="title">发表</div>
                    <div class="content">
                        <div>发布时间：
                            <input id="when-click-publish" type="checkbox" class="checkbox" ${click_publish_time_or_not(pre_working)}>
                            <label for="when-click-publish">当单击发布按钮时</label></div>
                        <div><input id="publish-time" type="text" class="input" value="${get_pre_content("time", pre_working)}"></div>
                        <div>类型：
                            <input id="working-is-writing" name="show_type" type="radio" value="writing" class="checkbox" ${get_working_type("writing", pre_working, True)}>
                            <label for="working-is-writing">文章</label>
                            <input id="working-is-page" name="show_type" type="radio" value="page" class="checkbox" ${get_working_type("page", pre_working, False)}>
                            <label for="working-is-page">页面</label></div>
                        <div>
                            ${allow_draft(pre_working)}
                            <div id="publish-now" class="button">立即发表</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form id="working-form" action="" method="post" autocomplete="off">
        <input id="real-id" type="hidden" name="working_id" autocomplete="off" value="${get_pre_content("_id", pre_working)}">
        <input id="real-method" type="hidden" name="working_method" value="${method}">
        <input id="real-title" type="hidden" name="working_title" autocomplete="off">
        <textarea id="real-content" name="working_content" autocomplete="off"></textarea>
        <input id="real-time" type="hidden" name="working_time" autocomplete="off">
        <input id="real-slug" type="hidden" name="working_slug" autocomplete="off">
        <input id="real-publish" type="hidden" name="working_publish" autocomplete="off">
        <input id="real-type" type="hidden" name="working_type" autocomplete="off">
        ${xsrf_form_html()}
    </form>
<%block name="js">
    <script src="${management_url("working.js")}" charset="utf-8"></script>
</%block>
${parent.footer()}
<%!
    def get_pre_content(type, pre_working):
        if not pre_working:
            return ""
        else:
            return pre_working[type]

    def click_publish_time_or_not(pre_working):
        if (not pre_working) or pre_working["time"] == 0:
            return "checked"
        return ""

    def get_working_type(type, pre_working, check_default=False):
        if not pre_working and check_default:
            return "checked"
        if not pre_working:
            return ""
        if pre_working["type"] != type:
            return "disabled"
        return "checked disabled"

    def allow_draft(pre_working):
        if not pre_working:
            return "<div id=\"save-as-draft\" class=\"button\">存为草稿</div>"
        if pre_working["publish"]:
            return ""
        return "<div id=\"save-as-draft\" class=\"button\">存为草稿</div>"
%>

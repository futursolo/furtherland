##
##   Copyright 2015 Futur Solo
##
##   Licensed under the Apache License, Version 2.0 (the "License");
##   you may not use this file except in compliance with the License.
##   You may obtain a copy of the License at
##
##       http://www.apache.org/licenses/LICENSE-2.0
##
##   Unless required by applicable law or agreed to in writing, software
##   distributed under the License is distributed on an "AS IS" BASIS,
##   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
##   See the License for the specific language governing permissions and
##   limitations under the License.
<!DOCTYPE HTML>
<html>
<head>
    <title><%block name="title">${page_title}</%block></title>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="referrer" content="origin">
    <meta property="og:title" content="${origin_title}">
    <meta property="og:url" content="${config["site_url"]}">
    <meta property="og:site_name" content="${config["site_name"]}">
    <meta name="description" content="${config["site_description"]}">
    <meta name="keywords" content="${config["site_keywords"]}">
    <meta name="generator" content="${FurtherLand.version()}">
    <link rel="canonical" href="${config["site_url"]}">
    <link href="//fonts.googleapis.com/css?family=Oxygen:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link href="${static_url("framework.css")}" rel="stylesheet" type="text/css"><%block name="css"/>
</head>
<body>
    ${self.body()}
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" charset="utf-8"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
    <script src="${static_url("framework.js")}" charset="utf-8"></script>
    ${config["trace_code"]}<%block name="js"/>
</body>
</html>
<%def name="header()">
<header style="background-image: url(${static_url("haru-header.jpg")});">
    <div class="container">
        <div class="check-control">
        % if not current_user:
            <div class="right">
                <a href="/management/checkin" class="check-button">登录</a>
            </div>
        % else:
            <div class="left">
                <a href="/management" class="check-button">${config["site_name"]}管理局</a>
            </div>
            <div class="right">
                <a href="/management/checkout" class="check-button">登出</a>
            </div>
        % endif
        </div>
        <div class="site-name"><a href="${config["site_url"]}">${config["site_name"]}</a></div>
        <div class="site-description">${config["site_description"]}</div>
    </div>
</header>
</%def>
<%def name="footer()">
<footer>
    <div class="container">
        <div class="copyright">&copy; 2015 <a href="${config["site_url"]}">${config["site_name"]}</a> All Rights Reserved.</div>
        <div class="powered">Powered by <a href="https://github.com/futursolo/FurtherLand">${FurtherLand.version()}</a>.</div>
    </div>
</footer>
</%def>
<%def name="replies()">
<div class="replies">
    <div class="container">
        <div class="title">评论</div>
        <div id="reply-list"></div>
        <div id="reply-alert"></div>
        <div class="new-reply">
            <div id="reply-id-input" class="id-input">
                <input id="reply-writing" type="hidden" value="${writing["_id"]}">
            % if current_user:
                <div class="loggedin">${current_user["username"]}さま、<br>您已经登录了。</div>
                <input id="reply-name" type="hidden">
                <input id="reply-email" type="hidden">
                <input id="reply-homepage" type="hidden">
            % else:
                <input id="reply-name" type="text" class="input" placeholder="昵称">
                <input id="reply-email" type="text" class="input" placeholder="电邮">
                <input id="reply-homepage" type="text" class="input" placeholder="个人主页（可选）">
            % endif
            </div>
            <div class="avatar-area">
                <div id="reply-avatar" class="avatar" style="background-image: url(${get_avatar(current_user, static_url)})"></div>
                <div id="publish-reply" class="button">发表</div>
            </div>
            <div id="reply-textarea-wrapper" class="textarea">
                <textarea class="hidden-textarea"></textarea>
                <textarea id="reply-textarea" class="visible-textarea" placeholder="評論支持Markdown哦！廣告和Spam統統惡靈退散！"></textarea>
            </div>
        </div>
    </div>
</div>
</%def>
<%!
    import hashlib
    import base64
    def get_avatar(current_user, static_url):
        if not current_user:
            return static_url("mm.jpg")
        else:
            email = hashlib.md5(current_user["email"].lower().encode(encoding="utf-8")).hexdigest()
            return "/channel/avatar/" + email + "?s=200&d=mm"
%>

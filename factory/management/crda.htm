##
##   Copyright 2015 Futur Solo
##
##   Licensed under the Apache License, Version 2.0 (the "License");
##   you may not use this file except in compliance with the License.
##   You may obtain a copy of the License at
##
##       http://www.apache.org/licenses/LICENSE-2.0
##
##   Unless required by applicable law or agreed to in writing, software
##   distributed under the License is distributed on an "AS IS" BASIS,
##   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
##   See the License for the specific language governing permissions and
##   limitations under the License.
<%inherit file="framework.htm"/>
<%block name="css">
<link href="${management_url("crda.css")}" rel="stylesheet" type="text/css">
</%block>
${parent.header()}
    <div class="main">
        <div class="container">
            <div class="page-title">${page_title}</div>
            <div class="type-selector">
                <span location="${config["site_url"]}/management/crda/writings">
                    <input id="check-writings" type="radio" name="check-type" ${current_check(area, "writings")}>
                    <label for="check-writings">文章</label>
                </span>
                <span location="${config["site_url"]}/management/crda/pages">
                    <input id="check-pages" type="radio" name="check-type" ${current_check(area, "pages")}>
                    <label for="check-pages">页面</label>
                </span>
                <span location="${config["site_url"]}/management/crda/replies">
                    <input id="check-replies" type="radio" name="check-type" ${current_check(area, "replies")}>
                    <label for="check-replies">评论</label>
                </span>
            </div>
    % if len(list(content.keys())) == 0:
        <div class="float-block">
            <div class="no-content">不要找了，这里什么也没有啦(*'▽')！</div>
        </div>
    % else:
            <div class="float-block">
                <div class="table-header table-item">
                % if area == "writings":
                    <div class="content-title">文章标题</div>
                    <div class="content-time">发表时间</div>
                % elif area == "pages":
                    <div class="content-title">页面标题</div>
                    <div class="content-time">发表时间</div>
                % elif area == "replies":
                    <div class="content-title">评论列表</div>
                % endif
                </div>
        % if area == "writings" or area == "pages":
            % for key in content:
                <div class="table-content table-item">
                    <div class="content-title"><a href="${content[key]["edit_link"]}">${content[key]["title"]}</a></div>
                % if ("publish" in list(content[key].keys())) and (not content[key]["publish"]):
                    <div class="content-draft">草稿</div>
                % endif
                % if area == "writings":
                    <div class="content-erase" type="writing" content="${content[key]["_id"]}">删除</div>
                % elif area == "pages":
                    <div class="content-erase" type="page" content="${content[key]["_id"]}">删除</div>
                % endif
                    <div class="content-time change-time">${content[key]["time"]}</div>
                </div>
            % endfor
        % else:
            % for key in content:
                <div class="table-reply-content table-item">
                    <div class="reply-avatar" style="background-image: url(/channel/avatar/${content[key]["emailmd5"]}?s=200&d=mm)"></div>
                    <div class="reply-content">
                        <div class="reply-name">
                            <a href="${content[key]["homepage"]}">${content[key]["name"]}</a>
                        % if not content[key]["permit"]:
                            <span class="reply-notchecked">待审核</span>
                        % endif
                        </div>
                        <div class="reply-privacy">
                            <span class="reply-email"><a href="mailto:${content[key]["email"]}">${content[key]["email"]}</a></span>
                            <span class="reply-ip">${content[key]["ip"]}</span>
                        </div>
                        <div class="reply-time">于 <span class="change-time">${content[key]["time"]}</span> 发表在 <a target="_blank" href="${config["site_url"]}/writings/${content[key]["writing"]["slug"]}.htm">${content[key]["writing"]["title"]}</a></div>
                        <div class="reply-body">${content[key]["content"]}</div>
                        <div class="reply-control">
                        % if not content[key]["permit"]:
                            <span class="reply-action permit-reply" reply="${content[key]["_id"]}">通过之</span>
                        % else:
                            <span class="reply-action unpermit-reply" reply="${content[key]["_id"]}">撤销通过</span>
                        % endif
                            <span class="reply-action delete-reply" reply="${content[key]["_id"]}">刪除</span>
                            <span class="reply-action edit-reply" reply="${content[key]["_id"]}">编辑</span>
                            <span class="reply-action unedit-reply" reply="${content[key]["_id"]}">取消编辑</span>
                        </div>
                        <div class="reply-editor" id="reply-editor-${content[key]["_id"]}">
                            <div class="content">
                                <div class="center-line">
                                    <div class="input-line"><input class="reply-editor-name input" type="text" placeholder="昵称" value="${content[key]["name"]}"></div>
                                    <div class="input-line"><input class="reply-editor-email input" type="text" placeholder="电邮" value="${content[key]["email"]}"></div>
                                    <div class="input-line"><input class="reply-editor-homepage input" type="text" placeholder="个人主页" value="${content[key]["homepage"]}"></div>
                                </div>
                                <div class="line content-line">
                                    <div class="textarea reply-editor-content-wrapper">
                                        <textarea class="hidden-textarea"></textarea>
                                        <textarea class="visible-textarea reply-editor-content" placeholder="内容">${content[key]["content"]}</textarea>
                                    </div>
                                </div>
                                <div class="line center-line"><div class="button post-reply-change" reply="${content[key]["_id"]}">提交更改</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            % endfor
        % endif
            </div>
    % endif
        </div>
    </div>
    <form id="hidden-reply-editor-form" method="post" action="">
        <input name="action" value="edit">
        <input id="real-reply-id" type="hidden" name="reply">
        <input id="real-reply-name" type="hidden" name="name">
        <input id="real-reply-email" type="hidden" name="email">
        <input id="real-reply-homepage" type="hidden" name="homepage">
        <textarea id="real-reply-content" name="content"></textarea>
        ${xsrf_form_html()}
    </form>
${parent.footer()}
<%block name="js">
    <script src="${management_url("crda.js")}" charset="utf-8"></script>
</%block>
<%!
    def current_check(area, this):
        if area == this:
            return "checked"
        return ""
%>
